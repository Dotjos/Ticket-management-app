{% extends "layouts/auth_layout.twig" %}

{% block content %}
<form id="loginForm" method="post" class="space-y-5">
  <!-- Email -->
  <div>
    <label for="email" class="block text-sm text-gray-600 mb-1">Email</label>
    <input
      id="email"
      name="email"
      type="email"
      placeholder="name@example.com"
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 outline-none"
    />
    <p id="emailError" class="hidden text-red-500 text-sm mt-1"></p>
  </div>

  <!-- Password -->
  <div>
    <label for="password" class="block text-sm text-gray-600 mb-1">Password</label>
    <input
      id="password"
      name="password"
      type="password"
      placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 outline-none"
    />
    <p id="passwordError" class="hidden text-red-500 text-sm mt-1"></p>
  </div>

  <!-- Submit -->
  <button
    type="submit"
    class="w-full bg-blue-800 text-white py-2 rounded-lg hover:bg-blue-900 transition"
  >
    Login
  </button>

  <p class="text-sm text-center text-gray-600">
    Donâ€™t have an account?
    <a href="?page=signup" class="text-blue-700 font-semibold">Sign Up</a>
  </p>
</form>
{% endblock %}

{% block scripts %}
  <!-- Toastify CDN -->
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <script>
    const form = document.getElementById("loginForm");

    form.addEventListener("submit", (e) => {
      e.preventDefault();

      console.log("Form submitted"); // ðŸ‘ˆ test if this logs


      // Input elements
      const email = document.getElementById("email");
      const password = document.getElementById("password");
      const emailError = document.getElementById("emailError");
      const passwordError = document.getElementById("passwordError");

      // Reset errors
      emailError.classList.add("hidden");
      passwordError.classList.add("hidden");
      emailError.textContent = "";
      passwordError.textContent = "";

      let valid = true;

      // Validate email
      if (!email.value) {
        emailError.textContent = "Email is required";
        emailError.classList.remove("hidden");
        valid = false;
      } else if (!/\S+@\S+\.\S+/.test(email.value)) {
        emailError.textContent = "Please enter a valid email";
        emailError.classList.remove("hidden");
        valid = false;
      }

      // Validate password
      if (!password.value) {
        passwordError.textContent = "Password is required";
        passwordError.classList.remove("hidden");
        valid = false;
      }

      if (!valid) {
        Toastify({
          text: "Please fix the errors and try again.",
          duration: 3000,
          gravity: "top",
          position: "right",
          backgroundColor: "#DC2626", // red
        }).showToast();
        return;
      }

      // Mock login success
      localStorage.setItem("ticketapp_session", "mock_token");

      Toastify({
        text: "Login successful!",
        duration: 2000,
        gravity: "top",
        position: "right",
        backgroundColor: "#1E40AF", // deep blue
      }).showToast();

      setTimeout(() => {
        window.location.href = "?page=dashboard";
      }, 1000);
    });
  </script>
{% endblock %}